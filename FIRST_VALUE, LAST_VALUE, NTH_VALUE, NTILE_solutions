--ğŸ”¹ LEVEL 1 â€” FIRST_VALUE / LAST_VALUE Basics
-- Q1.
-- Table: employees(emp_id, dept_id, salary)
-- Return each employeeâ€™s salary along with the highest salary in their department.
-- ğŸ‘‰ Must use FIRST_VALUE
SELECT emp_id, dept_id, salary,
	FIRST_VALUE(salary) OVER(PARTITION BY dept_id ORDER BY salary DESC) AS highest_salary
FROM employees;

-- Q2. âš ï¸ Interview Trap
-- Same table.
-- Return each employeeâ€™s salary along with the lowest salary in their department.
-- ğŸ‘‰ Must use LAST_VALUE
-- ğŸ‘‰ Frame clause matters
SELECT emp_id, dept_id, salary,
	LAST_VALUE(salary) OVER (
	PARTITION BY dept_id 
	ORDER BY salary DESC
	ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
) AS lowest_salary
FROM employees;

-- Q3.
-- Table: orders(order_id, customer_id, order_date, amount)
-- For each customer, show:
-- order_id
-- order_date
-- first order amount of that customer
SELECT order_id, order_date,
	FIRST_VALUE(amount) OVER(PARTITION BY customer_id ORDER BY order_date) AS first_order_amount
FROM orders;

-- ğŸ”¹ LEVEL 2 â€” Frame Awareness (VERY IMPORTANT)
-- Q4. âš ï¸ Common Mistake Question
-- Table: employees(emp_id, dept_id, salary)
-- Return:
-- emp_id
-- salary
-- department max salary using LAST_VALUE
-- ğŸ‘‰ Correct result required
-- ğŸ‘‰ Wrong framing will fail
SELECT emp_id, salary,
	LAST_VALUE(salary) OVER(PARTITION BY dept_id ORDER BY salary ASC ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS dept_max_salary
FROM employees;

-- Q5.
-- Same table.
-- Show each employeeâ€™s salary and department min salary using FIRST_VALUE.
SELECT emp_id, salary,
	FIRST_VALUE(salary) OVER(PARTITION BY dept_id ORDER BY salary ASC) AS dept_min_salary
FROM employees;

-- ğŸ”¹ LEVEL 3 â€” NTH_VALUE
-- Q6.
-- Table: employees(emp_id, dept_id, salary)
-- Find the 2nd highest salary in each department using NTH_VALUE.
-- ğŸ‘‰ No subqueries
-- ğŸ‘‰ Must use window function
SELECT emp_id, NTH_VALUE(salary) OVER(PARTITION BY dept_id ORDER BY salary DESC)........

-- currently, I am completely unaware of meaning of this NTH_VALUE, NTILE or UNBOUNDING ROW. I can't slve this right now.

-- Q7. âš ï¸ Edge Case
-- Same table.
-- Return:
-- dept_id
-- 3rd highest salary
-- If a department has fewer than 3 employees, return NULL
-- ğŸ‘‰ Use NTH_VALUE


-- Q8.
-- Table: students(student_id, subject, marks)
-- For each subject, return:
-- student_id
-- marks
-- 3rd topperâ€™s marks

-- ğŸ”¹ LEVEL 4 â€” NTILE (Bucketing / Segmentation)
-- Q9.
-- Table: employees(emp_id, salary)
-- Divide employees into 4 salary bands (quartiles).
-- Return:
-- emp_id
-- salary
-- salary_quartile

-- ğŸ‘‰ Use NTILE(4)
-- Q10.
-- Same table.
-- Identify top 25% salaried employees using NTILE.
-- Q11.
-- Table: sales(order_id, sale_date, amount)
-- Group sales into 5 equal buckets based on amount and show:
-- order_id
-- amount
-- bucket_number

-- ğŸ”¹ LEVEL 5 â€” Real Interview Scenarios
-- Q12. âš ï¸ Killer Question
-- Table: employees(emp_id, dept_id, salary)
-- For each employee, show:
-- salary
-- difference between salary and department highest salary
-- ğŸ‘‰ Must use FIRST_VALUE
-- ğŸ‘‰ No subqueries

-- Q13.
-- Table: orders(order_id, customer_id, order_date, amount)
-- For each order, show:
-- order_id
-- amount
-- customerâ€™s first order amount
-- difference from first order

-- Q14. âš ï¸ Trick Question
-- Table: employees(emp_id, dept_id, salary)
-- Why does the following query give wrong results?
-- SELECT emp_id, salary,
--        LAST_VALUE(salary) OVER (PARTITION BY dept_id ORDER BY salary) AS dept_min_salary
-- FROM employees;
-- ğŸ‘‰ Explain the issue
-- ğŸ‘‰ Provide corrected query

-- Q15. ğŸ’€ Ultimate
-- Table: employees(emp_id, dept_id, salary)
-- Return top 2 salaries per department using:
-- FIRST_VALUE
-- NTH_VALUE
-- NO RANK / DENSE_RANK / ROW_NUMBER
